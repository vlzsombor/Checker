@page "/"
@using Microsoft.AspNetCore.SignalR.Client;
@inject NavigationManager Navigation

@code {
    const string SERVER_URL = "https://localhost:7009";

    bool inGame = false;
    HubConnection hubConnection;
    string tableId;
    protected override void OnInitialized()
    {

        base.OnInitialized();

        hubConnection = new HubConnectionBuilder()
            .WithUrl(SERVER_URL+"/connect")
            .Build();
    }

    protected override async Task OnInitializedAsync()
    {

        await RefreshTable();

        await base.OnInitializedAsync();
    }

    List<string> tables = new();
    async Task RefreshTable()
    {
        HttpClient httpClient = new();
        tables = await httpClient.GetFromJsonAsync<List<string>>(SERVER_URL + "/Api/GetTables");
    }

    async Task CreateGame()
    {
        await hubConnection.StartAsync();
        this.tableId = Guid.NewGuid().ToString();
        await hubConnection.SendAsync("JoinTable", tableId);
        inGame = true;
    }

    async Task JoinGame(string tableId)
    {
        isWhitePlayer = false;
        this.tableId = tableId;
        await hubConnection.StartAsync();
        await hubConnection.SendAsync("JoinTable", tableId);
        inGame = true;

    }
    bool isWhitePlayer = true;

}

@if (inGame)
{
    <Checkerboard hubConnection="hubConnection" TableId="@tableId" IsWhitePlayer="@isWhitePlayer"/>
}
else
{
    <button @onclick="CreateGame">Create Game</button>

    @foreach(string table in tables)
    {
        <button @onclick="()=> JoinGame(table)">Join Table @table</button>
    }

}
